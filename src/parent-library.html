<!DOCTYPE html>
<!--
   COLLABORATORS:
   keren gu
   katie bartel
   
  -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>StoryTime</title>
    <!-- Load style sheets -->
    <link rel="stylesheet" type="text/css" href="style/main.css" />
    <!-- <link rel="stylesheet" type="text/css" href="style/kid-library.css" /> -->
    <link href="Booklet-master/booklet/jquery.booklet.latest.css" type="text/css" rel="stylesheet" media="screen, projection, tv" />

    <link href='http://fonts.googleapis.com/css?family=Englebert' rel='stylesheet' type='text/css'>

    <link type="text/css" href="style/parent-library.css" rel="stylesheet" />
    <script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script> window.jQuery || document.write('<script src="Booklet-master/booklet/jquery-2.1.0.min.js"><\/script>') </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script> window.jQuery.ui || document.write('<script src="Booklet-master/booklet/jquery-ui-1.10.4.min.js"><\/script>') </script>
    <script src="Booklet-master/booklet/jquery.easing.1.3.js"></script>
    <script src="Booklet-master/booklet/jquery.booklet.latest.js"></script>
    <script type='text/javascript' src='blur.js'></script>


    <script type = "text/javascript">
    var hIncr;
    var vIncr;
    var suppressBookHide = true;
    var mode;
    function createDescriptionView(){
      boardSize = 2.5;
      var incr = 600/boardSize;
      var hIncr = incr;
      var vIncr = incr;
    }


    function createGridView(perRow){
      mode = "grid"
      tableButton = document.getElementById("table-button");
      gridButton = document.getElementById("grid-button");
      tableButton.style.backgroundColor = "#d4f4f1";
      tableButton.style.color = "#666";
      gridButton.disabled = true;
      tableButton.disabled = false;
      console.log();
      hIncr = $('#column-right').height()/perRow;
      //vIncr = 600/boardSize*1.2;
      vIncr = hIncr * 5 /3;
      var book = 1;
      for(var i = 0; i < 12/perRow; i ++){
          for(var j = 0; j < perRow; j++){
              add(book.toString(),i,j);
              book++;
          }
      }

      loadListeners();

    }

    function add(name, row, col){
      var body = document.getElementById('column-right');

      var img = setImage(name, hIncr, vIncr);

      var container = document.createElement("div");
      container.setAttribute("id", "f1_container");
      var card = document.createElement("div");
      card.setAttribute("id", "f1_card");
      var front = document.createElement("div");
      front.className = "front face";
      front.appendChild(img);
      var back = document.createElement("div");
      back.className = "back face center";

      var rec = document.createElement("img");
      rec.src = '../graphics/record.png';
      rec.style.position = "relative";
      rec.style.top = "40%";
      rec.style.left = "8%"
      back.appendChild(rec);
      card.appendChild(front);
      card.appendChild(back);
      container.appendChild(card);

      container.style.position = "absolute";
      container.style.left = 70+col*vIncr + "px";
      container.style.top = 10+row*hIncr*1.7 + "px";
      body.appendChild(container);
    }

    function setImage(name, hIncr, vIncr){
     // console.log(name);
      var img = document.createElement("img");
      img.src = '../graphics/'+name+".jpeg";
    
      img.style.width = hIncr+"px";
      img.style.height = "auto";
      img.style.zIndex = "1";
      img.setAttribute("id",name)
      img.setAttribute("draggable",false);
    
      //console.log(hIncr, vIncr);
      //console.log(img);
      return img;
    }

    function createRowView(){
      mode = "row"
      tableButton = document.getElementById("table-button");
      gridButton = document.getElementById("grid-button");
      gridButton.disabled = false;
      tableButton.disabled = true;
      gridButton.style.backgroundColor = "#d4f4f1";
      gridButton.style.color = "#666";      
      boardSize = 4;
      var incr = $('#column-right').height()/boardSize;
      var hIncr = incr;
      var vIncr = incr;
     // console.log(vIncr,hIncr);
      var body = document.getElementById('column-right');

      for (var j = 0; j <=11; j++){
        var div = document.createElement("div");
        div.style.position = "relative";
        div.style.left = 2+"%";
        div.style.top = .2*hIncr * j + "px";
        div.className = "book-div"
        //div.style.textAlign = "left"
        div.style.width = 93 + "%";
        var img = setImage((j+1).toString(), hIncr,vIncr);
        img.height = hIncr + "px";
        img.style.position = "relative";




        //img.style.left = 5 + "px";
        //img.style.display = "inline";
        //var p = document.createElement("p");
        var text = document.createTextNode("The Giving Tree is a children's picture book written and illustrated by Shel Silverstein. First published in 1964 by Harper & Row, it has become one of Silverstein's best known titles and has been translated into numerous languages. Some argue that the popularity of the book is due to the romantic relationship between the child and   the tree. However, others are of the opinion that such a relationship should not be portrayed to children at such a young age, for fear that they will join the gays.  Research has shown that this fear is unfounded, as tree lovers have an equal occurence of homosexuality as the general population."); 

        var tbl = document.createElement("table");
        var tblBody = document.createElement("tbody");

        tbl.setAttribute('border', '0');
        var row = document.createElement('tr');
        var cell1 = document.createElement("td");

        var container = document.createElement("div");
        container.setAttribute("id", "f1_container");
       /* var card = document.createElement("div");
        card.setAttribute("id", "f1_card");
        var front = document.createElement("div");
        front.className = "front face";
        front.appendChild(img);
        var back = document.createElement("div");
        back.className = "back face center";

        var rec = document.createElement("img");
        rec.src = '../graphics/record.png';
        rec.style.position = "relative";
        rec.style.top = "40%";
        rec.style.left = "8%"
        back.appendChild(rec);

        card.appendChild(front);
        card.appendChild(back);
        container.appendChild(card);*/
        //container.height = img.height;
        //container.width = img.width;
        container.appendChild(img);

        cell1.appendChild(container);
        cell1.style.width = "190px";
        row.appendChild(cell1);
        cell2 = document.createElement("td");
        cell2.appendChild(text);
        cell2.style.width = "800px";
        cell2.style.textAlign = "left"
        //cell2.style.left = 10+"px";
        row.appendChild(cell2);
        tblBody.appendChild(row);
        tbl.appendChild(tblBody);
        div.appendChild(tbl);
        //p.appendChild(text);
        //p.style.whiteSpace = ;
        //div.appendChild(img);
        //div.appendChild(p);
        body.appendChild(div);
      }
      loadListeners();
    }

    function openBook(book){
          $("body").append("<div class='blur-overlay'></div>");

          //var id = book[0].id;
          $(".book-popup").show();
          $("#mybook").show();

          $('#cancel-popup').click(function(){
            $('.blur-overlay').remove();
            $(".book-popup").hide();
            $("#mybook").hide();
          });

          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);
          $('#boldText').animate({"color": "#0000FF"},500);
          $('#boldText').animate({"color": "#000000"},500);

          ("#play-button").click(function(){
            var divElement = $('.b-p1').find('.p-title')[0];
            var title = divElement.title;
            console.log(title);
            var audio = document.getElementById(title);
            audio.play();
          });

          $(".book-popup").append(playButton);
        }

    function loadListeners(){
     /* $(".front").on("click", function(e){
        console.log("clicked front");
        console.log(e.target.parentNode.parentNode.getAttribute('id'));

        $(e.target.parentNode.parentNode).css("transform","rotateY(180deg)")

        setTimeout(function(){
          var back = e.target.parentNode.parentNode.children[1];
          console.log(back.getAttribute('id'));
          //var back = e.target.parentNode.parentNode.parentNode;
          var cancel = document.createElement("img");
          cancel.setAttribute("id", "cancel-book");
          cancel.className = "cancel-button";
          cancel.style.type = "button";
          back.appendChild(cancel);
        }, 100);
        

        //  ("book");
      });

      /*$(".back").on("click", function(e){
        console.log("clicked back");
        restoreBook(e.target)
        if(e.target.getAttribute("id")!="cancel-book"){
          openBook("book");
        }/*else{
          console.log(e.target.parentNode.parentNode.getAttribute('id'));
          $(e.target.parentNode.parentNode).css("transform","rotateY(0deg)") 
        }
        
        
      })*/

      $("#record-button").on("click",function(e){
        openBook("book");
      })

      $("#cancel-button").on("click", function(e){
        console.log("clicked cancel");
        /*console.log(e.target.getAttribute("id"));
        console.log(e.parentNode.parentNode.parentNode.getAttribute("id"));
        $(e.target.parentNode.parentNode.parentNode).css("transform","rotateY(-180deg)")*/
      }
      )
    }
    function restoreBook(target){
      var currentNode = target;
      while(currentNode.getAttribute("id")!= "f1_card"){
        currentNode = currentNode.parentNode;
      }
      $(currentNode).css("transform","rotateY(0deg)") 
    }
    $(document).ready(function() {
      // Format the booklet
      $("#mybook").booklet({ 
        pageNumbers: false,
        height: '100%',
        width: '80%',
        closed: true,
        autoCenter: true,
        arrows: true,
        arrowsHide: true
      });
      $(".book-popup").hide();
      $("#mybook").hide();
      $("#mybook").show();

    /*  $('#library-div').blurjs({
        draggable: true,
        overlay: 'rgba(255,255,255,0.1)',
        radius:10
      }); */

      // Hide the possible book at first
      //$("#mybook").hide()
 /*     var cue = document.getElementById("recording");
      $("h3").mouseup(function(){
        cue.innerHTML = "<img src = '../graphics/not-record.png'>";
      });
      $("h3").mousedown(function(){
        cue.innerHTML = "<img src = '../graphics/record.png'>";
        var pointer = document.getElementById("pointer");
        pointer.innerHTML = "";
        $("#pointer").finish();
      });

      $("#library-div").on("click", function(e) {
        console.log("clicked, trying to exit");
        console.log(suppressBookHide);
        console.log("visible? " + $('#mybook').is(':visible'));
        if($('#mybook').is(':visible') && !suppressBookHide) {
          console.log("book is hidden");
          $("#mybook").hide();
        }
        suppressBookHide = false;
      });   */

      //createGridView(4);
      createRowView();
      tableButton = document.getElementById("table-button");
      tableButton.style.color = "#FFF";
      tableButton.style.backgroundColor = "#2CCCBC";
     
      // Clicking on a book should unhide the book view
      $('.imgContain').on("click","a,img", function (e) {
        var id = e.target.getAttribute('id');
        e.preventDefault();
        if(e.target.className == "record-button"){
          $('.blur-overlay').remove();
          $('#cancel-button').remove();
          $('.record-button').remove();
          openBook("book");

        }
        if(e.target.className!="record-button" && e.target.parentNode.childNodes.length == 1){

          console.log("clicked img");
          var book = e.target.parentNode;
          var blur = document.createElement("img");
          blur.className = "blur-overlay";
          blur.style.zIndex = 99;
          book.appendChild(blur);
          var record = document.createElement("img");
          record.setAttribute("id","record");
          record.className = "record-button";
          record.style.type = "button";
          blur.width = e.target.width;
          blur.height = e.target.height;
          var button = document.createElement("input");
          button.type = "button";
          button.value = "Cancel";
          button.id = "cancel-button";
          button.style.zIndex = 100;
          button.onclick = function(){
            $('.blur-overlay').remove();
            $('#cancel-button').remove();
            $('.record-button').remove();
          }
          button.style.position = "absolute";

          button.style.left = "30%";
          button.style.top = "55%";
          book.appendChild(button);
          /*var cancel = document.createElement("img");
          cancel.setAttribute("id", "cancel-book");
          cancel.className = "cancel-button";
          cancel.style.type = "button";*/
          book.appendChild(record);
          loadListeners();
/*          $(e.target.parentNode.parentNode).css("transform","rotateY(180deg)") 

          setTimeout(function(){
            var back = e.target.parentNode.parentNode;
            console.log(back.getAttribute('id'));
            console.log(back.className);
            //var back = e.target.parentNode.parentNode.parentNode;
            var cancel = document.createElement("img");
            cancel.setAttribute("id", "cancel-book");
            cancel.className = "cancel-button";
            cancel.style.type = "button";
            back.appendChild(cancel);
          }, 100);*/
        }
          //openBook("book");
        //alert('You Clicked On Book '+id);
        //window.location.href = 'recording.html'
      });

      loadListeners();


/*      $('#column-left').on("click","a,img", function (e) {
        var id = e.target.getAttribute('id');
        var label = e.target;
       
        e.preventDefault();
      });
*/
      // Prevent typical dragging functionality
      $(document).on('dragstart', function(event) { event.preventDefault(); });

      $('#column-left-contents').on("click","div", function (e) {

        var id = e.target.getAttribute('id');
        if(e.target.className == "list"){
          var label = e.target.parentNode;
        }else{
          var label = e.target;
        }
        var oldLabel = document.getElementsByClassName("current")[0]
        oldLabel.style.color = "grey";
        oldLabel.className = "";
        label.style.color = "#FFF";
        label.className = "current";
        e.preventDefault();
        //window.location.href = 'Book.html'
      });

      $("#grid-button").click(function(evt){
        console.log("viewing Grid!")
        $(".imgContain").empty();
        createGridView(4);
        console.log("viewing grid!");
      });

      $("#table-button").click(function(evt){
        console.log("viewing Table!")
        $(".imgContain").empty();
        createRowView();
        console.log("viewing table!");
      });

      $('#logo-navigation-button').click(function(){
          console.log("go to home")
          window.location.href = 'home.html';
        });

      $('#new-list').click(function(){
        $("body").append("<div class='blur-overlay'></div>");

        // make pop up
        var $div = $("<div>", {id:"new-list-popup", class:"popup"});

        $div.append("<h3 class='title'>New Reading List</h3>");
        $div.append("<p class='popup-text'>What do you want to name your list?</p>");
        $div.append("<input id='popup-answer' class='popup-text' type='text' name='answer' placeholder='Press \<Enter\> to submit.'>");
        $div.append($("<img>", {type:"button", id:"cancel-popup-new-list", class:"cancel-button"}));
        $("body").append($div);

        // implement functionality for close
        $('#cancel-popup-new-list').click(function(){
          $('.blur-overlay').remove();
          $('#new-list-popup').remove();
        });

        $('#popup-answer').keypress(function(event){
          if(event.which == 13){
            //Pressed Enter
            var val = $('#popup-answer').val();
            if(val.replace(' ','')){
              var list = document.getElementById("reading-lists");
              var item = document.createElement("li");
              var div = document.createElement("div");
              div.className = "list";
              div.setAttribute('id', val.replace(' ',''));
              var text = document.createTextNode(val);
              div.appendChild(text);
              item.appendChild(div);
              list.appendChild(item);
              var oldLabel = document.getElementsByClassName("current")[0]
              oldLabel.style.color = "grey";
              oldLabel.className = "";
              item.style.color = "#FFF";
              item.className = "current";    
            }
            $('#new-list-popup').remove();
            $('.blur-overlay').remove();

          }
        });
    });

      $('#table-button').hover(function(){
        if(mode != "row"){
          // mouseenter
          $(this).animate({'background-color':'#2CCCBC', "color": "#FFF"},300);
        }
      }, function(){
        if(mode != "row"){
          // mouseleave
          $(this).animate({'background-color':'#d4f4f1', "color": "#666"},300);
        }
      });

      $('#grid-button').hover(function(){
        if(mode != "grid"){
          // mouseenter
          $(this).animate({'background-color':'#2CCCBC', "color": "#FFF"},300);
        }
      }, function(){
        if(mode != "grid"){
          // mouseleave
          $(this).animate({'background-color':'#d4f4f1', "color": "#666"},300);
        }
      });       

    });
    </script>
  </head>
  
  <body>
    <div class="wrapper">
      <div id="big-frame">
        <div class="top-navigation">
          <div id="grid-button" class = "bar-button" type="button"/> 
          Grid 
        </div>
        <div id="table-button" class = "bar-button" type="button"/> 
        Table 
      </div>
      <div id="logo-navigation-button" type="button">
        <span class="story">Story</span><span class="time">Time</span>
      </div>

    </div>        

    <div id="library-div" class="main-frame">
      <div id="column-left">
        <ul id = "column-left-contents" >
          <span id = "search"><label> Search </label> <input type = "text" name = "search"></span>
          <li class = "section" id = "library"><div class = "current" href = "#"> &nbsp My Library</a></li>
          <div id = "library-contents">
            <ul id = "reading-lists">
              <li><div class = "list" id = "dogs">Dogs</div></li>
              <li><div class = "list" id = "nature">Nature</div></li>
              <li><div class = "list" id = "robots">Robots</div></li>
              <li><div class = "list" id = "dragons">Dragons</div></li>
            </ul> 
          </div>
            <li class = "section"><div href = "#">&nbsp Discover More Books</a></li>
          
        </ul>
        <ul type="none">
          <li id = "new-list"><div href = "#">+ New Reading List</a></li>
        </ul>
      </div>
      <div id="column-center">
        <p>  </p>
      </div>
      <div id="column-right" class = "imgContain">
      </div>
    </div>

  </div>
  </div>

    <div class = "book-popup">
    <div id='mybook' style="height:600px; width:auto;">
      <!-- FIRST PAGE -->
      <div  class="p-title" title='first-page'> 
          <img src = '../graphics/book/GivingTree.jpg' style="position: relative; height:100%; width:100%"> 
          <audio controls id="first-page" class="audio-controls">
            <source src="../audios/first-page.mp3" type="audio/mp3">
            Your browser does not support the audio element.
          </audio>
      </div>
      <!-- SECOND PAGE -->
      <div class="p-title" title='second-page'>
          <div id = "boldText">Once there was a tree</div>
          <div id='pointer' style='position:absolute;'><img src = '../graphics/pointer.png'></div>
          <!-- <img src = '../graphics/book/Maple-tree.png'> -->
      </div>
      <!-- THIRD PAGE -->
      <div  class="p-title" title='third-page'>
        <h3>That loved a little boy</h3>
        <img src = '../graphics/book/boy.png'>
        <audio controls id="third-page" class="audio-controls">
          <source src="../audios/third-page.mp3" type="audio/mp3">
          Your browser does not support the audio element.
        </audio>  
      </div>
      <!-- FOURTH PAGE -->
      <div  class="p-title" title='fourth-page'>
        <h3>And every day the boy would come</h3>
        <!-- <embed class="audio" id="fourth-page" src="../audio/fourth-page.mp3"> -->
      </div>
      <!-- FIFTH PAGE -->
      <div  class="p-title" title='fifth-page'>
        <h3>All over the tree!</h3>
        <audio controls id="first-page" class="audio-controls">
          <source src="../audios/first-page.mp3" type="audio/mp3">
          Your browser does not support the audio element.
        </audio>
      </div>
      <!-- SIXTH PAGE -->
      <div  class="p-title" title='sixth-page'>
        <h3>The End.</h3>
        <h2><a href = 'kid-library.html'>here</a></h2>
      </div>
    <!-- END OF BOOK -->
    </div> 

    <img id="cancel-popup" class="cancel-button"/>

    <img id="play-button" src="../graphics/play2.png">
  </div>

</body>
</html>
