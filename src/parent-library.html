<!DOCTYPE html>
<!--
   COLLABORATORS:
   keren gu
   katie bartel
   
  -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>StoryTime</title>
    <!-- Load style sheets -->
    <link rel="stylesheet" type="text/css" href="style/main.css" />
    <!-- <link rel="stylesheet" type="text/css" href="style/kid-library.css" /> -->
    <link href="Booklet-master/booklet/jquery.booklet.latest.css" type="text/css" rel="stylesheet" media="screen, projection, tv" />

    <link href='http://fonts.googleapis.com/css?family=Englebert' rel='stylesheet' type='text/css'>

    <link type="text/css" href="style/parent-library.css" rel="stylesheet" />
    <script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script> window.jQuery || document.write('<script src="Booklet-master/booklet/jquery-2.1.0.min.js"><\/script>') </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script> window.jQuery.ui || document.write('<script src="Booklet-master/booklet/jquery-ui-1.10.4.min.js"><\/script>') </script>
    <script src="Booklet-master/booklet/jquery.easing.1.3.js"></script>
    <script src="Booklet-master/booklet/jquery.booklet.latest.js"></script>
    <script type='text/javascript' src='blur.js'></script>


    <script type = "text/javascript">
    var hIncr;
    var vIncr;
    var suppressBookHide = true;
    var mode;
    function createDescriptionView(){
      boardSize = 2.5;
      var incr = 600/boardSize;
      var hIncr = incr;
      var vIncr = incr;
    }


    function createGridView(perRow){
      mode = "grid"
      tableButton = document.getElementById("table-button");
      gridButton = document.getElementById("grid-button");
      tableButton.style.backgroundColor = "#d4f4f1";
      tableButton.style.color = "#666";
      gridButton.disabled = true;
      tableButton.disabled = false;
      console.log();
      hIncr = $('#column-right').height()/perRow;
      //vIncr = 600/boardSize*1.2;
      vIncr = hIncr * 5 /3;
      var book = 1;
      for(var i = 0; i < 12/perRow; i ++){
          for(var j = 0; j < perRow; j++){
              add(book.toString(),i,j);
              book++;
          }
      }

      loadListeners();

    }

    function add(name, row, col){
      var body = document.getElementById('column-right');

      var img = setImage(name, hIncr, vIncr);

      img.className = "bookCover";

      var container = document.createElement("div");
      container.setAttribute("id", "f1_container");
      var card = document.createElement("div");
      card.setAttribute("id", "f1_card");
      var front = document.createElement("div");
      front.className = "front face";
      front.appendChild(img);
      var back = document.createElement("div");
      back.className = "back face center";

      var rec = document.createElement("img");
      rec.src = '../graphics/record.png';
      rec.style.position = "relative";
      rec.style.top = "40%";
      rec.style.left = "8%"
      back.appendChild(rec);
      card.appendChild(front);
      card.appendChild(back);
      container.appendChild(card);

      container.style.position = "absolute";
      container.style.left = 70+col*vIncr + "px";
      container.style.top = 10+row*hIncr*1.7 + "px";
      body.appendChild(container);
    }

    function setImage(name, hIncr, vIncr){
     // console.log(name);
      var img = document.createElement("img");
      img.src = '../graphics/'+name+".jpeg";

      img.className = "bookCover";
    
      img.style.width = hIncr+"px";
      img.style.height = "auto";
      img.style.zIndex = "1";
      img.setAttribute("id",name)
      img.setAttribute("draggable",false);
    
      //console.log(hIncr, vIncr);
      //console.log(img);
      return img;
    }

    function boldHTML(text) {
      var element = document.createElement("b");
      element.innerHTML = text;
      return element;
    }

    function createRowView(){
      mode = "row"
      tableButton = document.getElementById("table-button");
      gridButton = document.getElementById("grid-button");
      gridButton.disabled = false;
      tableButton.disabled = true;
      gridButton.style.backgroundColor = "#d4f4f1";
      gridButton.style.color = "#666";      
      boardSize = 4;
      var incr = $('#column-right').height()/boardSize;
      var hIncr = incr;
      var vIncr = incr;
     // console.log(vIncr,hIncr);
      var body = document.getElementById('column-right');

      for (var j = 0; j <=11; j++){
        var div = document.createElement("div");
        div.style.position = "relative";
        div.style.left = 2+"%";
        div.style.top = .2*hIncr * j + "px";
        div.className = "book-div"
        //div.style.textAlign = "left"
        div.style.width = 93 + "%";
        var img = setImage((j+1).toString(), hIncr,vIncr);
        img.height = hIncr + "px";
        img.style.position = "relative";




        //img.style.left = 5 + "px";
        //img.style.display = "inline";
        //var p = document.createElement("p");

        //$div.append("<p class='popup-text'>What do you want to name your list?</p>");
        //$div.append("<input id='popup-answer' class='popup-text' type='text' name='answer' placeholder='Press \<Enter\> to submit.'>");
        //$div.append($("<img>", {type:"button", id:"cancel-popup-new-list", class:"cancel-button"}));




        var tbl = document.createElement("table");
        var tblBody = document.createElement("tbody");

        tbl.setAttribute('border', '0');
        var row = document.createElement('tr');
        var cell1 = document.createElement("td");

        var container = document.createElement("div");
        container.setAttribute("id", "f1_container");
       /* var card = document.createElement("div");
        card.setAttribute("id", "f1_card");
        var front = document.createElement("div");
        front.className = "front face";
        front.appendChild(img);
        var back = document.createElement("div");
        back.className = "back face center";

        var rec = document.createElement("img");
        rec.src = '../graphics/record.png';
        rec.style.position = "relative";
        rec.style.top = "40%";
        rec.style.left = "8%"
        back.appendChild(rec);

        card.appendChild(front);
        card.appendChild(back);
        container.appendChild(card);*/
        //container.height = img.height;
        //container.width = img.width;
        container.appendChild(img);

        cell1.appendChild(container);
        cell1.style.width = "190px";
        row.appendChild(cell1);
        cell2 = document.createElement("td");
        /*cell2.appendChild(title);
        cell2.appendChild(text);
        cell2.appendChild(document.createElement("br"));
        cell2.appendChild(author);
        cell2.appendChild(text2);
        cell2.appendChild(document.createElement("br"));
        cell2.appendChild(document.createElement("br"));
        cell2.appendChild(synopsis);
        cell2.appendChild(text3);*/
        cell2.appendChild(boldHTML("Title: "));
        cell2.appendChild(document.createTextNode("The Giving Tree"));
        cell2.appendChild(document.createElement("br"));
        cell2.appendChild(boldHTML("Author: "));
        cell2.appendChild(document.createTextNode("Shel Silverstein"));
        cell2.appendChild(document.createElement("br"));
        cell2.appendChild(document.createElement("br"));
        cell2.appendChild(boldHTML("Synopsis: "));
        cell2.appendChild(document.createTextNode("The Giving Tree is a children's picture book written and illustrated by Shel Silverstein. First published in 1964 by Harper & Row, it has become one of Silverstein's best known titles and has been translated into numerous languages."));

        cell2.style.width = "800px";
        cell2.style.textAlign = "left"
        //cell2.style.left = 10+"px";
        row.appendChild(cell2);
        tblBody.appendChild(row);
        tbl.appendChild(tblBody);
        div.appendChild(tbl);
        //p.appendChild(text);
        //p.style.whiteSpace = ;
        //div.appendChild(img);
        //div.appendChild(p);
        body.appendChild(div);
      }
      loadListeners();
    }

    function movePointer() {
      var divElement = $('.b-p1').find('.p-title')[0];
      var title = divElement.title;
      //if (title == "second-page") {
        $("#pointer").show();
        $("#pointer").animate({left: "+=500"}, 300);
      //}
    }


    function openBook(book){
        $("#mybook").booklet({ 
          pageNumbers: false,
          height: '100%',
          width: '80%',
          closed: true,
          autoCenter: true,
          arrows: true,
          arrowsHide: true
        });

         $('.book-text').mousedown(function(){
            $('#pointer').hide();
            // turn recording button on
            $("#recording").attr('src', "../graphics/record.png");
          });

         $('.book-text').mouseup(function(){
            // turn recording button off
            $("#recording").attr('src', "../graphics/not-record.png");
          });

         $('#mybook').mouseup(function(){
            // turn recording button off
            $("#recording").attr('src', "../graphics/not-record.png");
          });

          //movePointer();



          $("body").append("<div class='blur-overlay'></div>");

          $("#pointer").animate({left: "+=200"}, 3000);
          $("#pointer").animate({left: "-=200"}, 500);
          $("#pointer").animate({left: "+=200"}, 3000);
          $("#pointer").animate({left: "-=200"}, 500);
          $("#pointer").animate({left: "+=200"}, 3000);
          $("#pointer").animate({left: "-=200"}, 500);
          $("#pointer").animate({left: "+=200"}, 3000);
          $("#pointer").animate({left: "-=200"}, 500);
          $("#pointer").animate({left: "+=200"}, 3000);
          $("#pointer").animate({left: "-=200"}, 500);
          $("#pointer").animate({left: "+=200"}, 3000);
          $("#pointer").animate({left: "-=200"}, 500);

          //var id = book[0].id;
          $(".book-popup").show();
          $("#mybook").show();

          $('#cancel-popup').click(function(){
            $('.blur-overlay').remove();
            $(".book-popup").hide();
            $("#mybook").hide();
          });

          $("#play-button").click(function(){
            var divElement = $('.b-p1').find('.p-title')[0];
            var title = divElement.title;
            console.log(title);
            var audio = document.getElementById(title);
            audio.play();
          });

          $(".book-popup").append(playButton);


          
    }

    
    

    function loadListeners(){
     /* $(".front").on("click", function(e){
        console.log("clicked front");
        console.log(e.target.parentNode.parentNode.getAttribute('id'));

        $(e.target.parentNode.parentNode).css("transform","rotateY(180deg)")

        setTimeout(function(){
          var back = e.target.parentNode.parentNode.children[1];
          console.log(back.getAttribute('id'));
          //var back = e.target.parentNode.parentNode.parentNode;
          var cancel = document.createElement("img");
          cancel.setAttribute("id", "cancel-book");
          cancel.className = "cancel-button";
          cancel.style.type = "button";
          back.appendChild(cancel);
        }, 100);
        

        //  ("book");
      });

      /*$(".back").on("click", function(e){
        console.log("clicked back");
        restoreBook(e.target)
        if(e.target.getAttribute("id")!="cancel-book"){
          openBook("book");
        }/*else{
          console.log(e.target.parentNode.parentNode.getAttribute('id'));
          $(e.target.parentNode.parentNode).css("transform","rotateY(0deg)") 
        }
        
        
      })*/

      $("#record-button").on("click",function(e){
        openBook("book");
      })

      $("#cancel-button").on("click", function(e){
        console.log("clicked cancel");
        /*console.log(e.target.getAttribute("id"));
        console.log(e.parentNode.parentNode.parentNode.getAttribute("id"));
        $(e.target.parentNode.parentNode.parentNode).css("transform","rotateY(-180deg)")*/
      }
      )
    }
    function restoreBook(target){
      var currentNode = target;
      while(currentNode.getAttribute("id")!= "f1_card"){
        currentNode = currentNode.parentNode;
      }
      $(currentNode).css("transform","rotateY(0deg)") 
    }
    $(document).ready(function() {
      // Format the booklet
      $("#mybook").booklet({ 
        pageNumbers: false,
        height: '100%',
        width: '80%',
        closed: true,
        autoCenter: true,
        arrows: true,
        arrowsHide: true
      });

        $(".book-popup").hide();
        $("#mybook").hide();
        $("#mybook").show();

        $('#exit-book').click(function(){
          $('.blur-overlay').remove();
          $(".book-popup").hide();
          $("#mybook").hide();
      });
      $('#exit-book-label').click(function(){
          $('.blur-overlay').remove();
          $(".book-popup").hide();
          $("#mybook").hide();
      });

      $('#re-read').click(function(){
          $('.blur-overlay').remove();
          $(".book-popup").hide();
          $("#mybook").hide();
      });
      $('#re-read-label').click(function(){
          $('.blur-overlay').remove();
          $(".book-popup").hide();
          $("#mybook").hide();
      });

      $("#library-div").on("click", function(e) {
        console.log("clicked, trying to exit");
        console.log(suppressBookHide);
        console.log("visible? " + $('#mybook').is(':visible'));
       console.log(e.target.className);

        if(e.target.className != "bookCover" && e.target.className != "blur-overlay"){
          $('#blurrer').remove();
          $('#cancel-button').remove();
          $('.record-button').remove();
          //openBook("book");

        }
        /*if($('#mybook').is(':visible') && !suppressBookHide) {
          console.log("book is hidden");
          $("#mybook").hide();
        }
        suppressBookHide = false;*/
      });

    /*  $('#library-div').blurjs({
        draggable: true,
        overlay: 'rgba(255,255,255,0.1)',
        radius:10
      }); */

      // Hide the possible book at first
      //$("#mybook").hide()
  /*    var cue = document.getElementById("recording");
      $("h3").mouseup(function(){
        cue.innerHTML = "<img src = '../graphics/not-record.png'>";
      });
      $("h3").mousedown(function(){
        cue.innerHTML = "<img src = '../graphics/record.png'>";
        var pointer = document.getElementById("pointer");
        pointer.innerHTML = "";
        $("#pointer").finish();
      });

      $("#library-div").on("click", function(e) {
        console.log("clicked, trying to exit");
        console.log(suppressBookHide);
        console.log("visible? " + $('#mybook').is(':visible'));
        if($('#mybook').is(':visible') && !suppressBookHide) {
          console.log("book is hidden");
          $("#mybook").hide();
        }
        suppressBookHide = false;
      });   */

      //createGridView(4);
      createRowView();
      tableButton = document.getElementById("table-button");
      tableButton.style.color = "#FFF";
      tableButton.style.backgroundColor = "#2CCCBC";
     
      // Clicking on a book should unhide the book view
      $('.imgContain').on("click","a,img", function (e) {
        var id = e.target.getAttribute('id');
        e.preventDefault();
        if(e.target.className == "record-button"){
          $('#blurrer').remove();
          $('#cancel-button').remove();
          $('.record-button').remove();
          openBook("book");

        }
        if(e.target.className!="record-button" && e.target.parentNode.childNodes.length == 1){

          console.log("clicked img");
          var book = e.target.parentNode;
          var blur = document.createElement("img");
          blur.className = "blur-overlay";
          blur.setAttribute("id","blurrer")
          blur.style.zIndex = 99;
          book.appendChild(blur);
          var record = document.createElement("img");
          record.setAttribute("id","record");
          record.className = "record-button";
          record.style.type = "button";
          blur.width = e.target.width;
          blur.height = e.target.height;
          var button = document.createElement("input");
          button.type = "button";
          button.value = "Cancel";
          button.id = "cancel-button";
          button.style.zIndex = 100;
          button.onclick = function(){
            $('#blurrer').remove();
            $('#cancel-button').remove();
            $('.record-button').remove();
          }
          button.style.position = "absolute";

          button.style.left = "30%";
          button.style.top = "55%";
          book.appendChild(button);
          /*var cancel = document.createElement("img");
          cancel.setAttribute("id", "cancel-book");
          cancel.className = "cancel-button";
          cancel.style.type = "button";*/
          book.appendChild(record);
          loadListeners();
/*          $(e.target.parentNode.parentNode).css("transform","rotateY(180deg)") 

          setTimeout(function(){
            var back = e.target.parentNode.parentNode;
            console.log(back.getAttribute('id'));
            console.log(back.className);
            //var back = e.target.parentNode.parentNode.parentNode;
            var cancel = document.createElement("img");
            cancel.setAttribute("id", "cancel-book");
            cancel.className = "cancel-button";
            cancel.style.type = "button";
            back.appendChild(cancel);
          }, 100);*/
        }
          //openBook("book");
        //alert('You Clicked On Book '+id);
        //window.location.href = 'recording.html'
      });

      loadListeners();


/*      $('#column-left').on("click","a,img", function (e) {
        var id = e.target.getAttribute('id');
        var label = e.target;
       
        e.preventDefault();
      });
*/
      // Prevent typical dragging functionality
      $(document).on('dragstart', function(event) { event.preventDefault(); });

      $('#column-left-contents').on("click","div", function (e) {

        var id = e.target.getAttribute('id');
        if(e.target.className == "list"){
          var label = e.target.parentNode;
        }else{
          var label = e.target;
        }
        var oldLabel = document.getElementsByClassName("current")[0]
        oldLabel.style.color = "grey";
        oldLabel.className = "";
        label.style.color = "#FFF";
        label.className = "current";
        e.preventDefault();
        //window.location.href = 'Book.html'
      });

      $("#grid-button").click(function(evt){
        console.log("viewing Grid!")
        $(".imgContain").empty();
        createGridView(4);
        console.log("viewing grid!");
      });

      $("#table-button").click(function(evt){
        console.log("viewing Table!")
        $(".imgContain").empty();
        createRowView();
        console.log("viewing table!");
      });

      $('#logo-navigation-button').click(function(){
          console.log("go to home")
          window.location.href = 'home.html';
        });

      $('#new-list').click(function(){
        $("body").append("<div class='blur-overlay'></div>");

        // make pop up
        var $div = $("<div>", {id:"new-list-popup", class:"popup"});

        $div.append("<h3 class='title'>New Reading List</h3>");
        $div.append("<p class='popup-text'>What do you want to name your list?</p>");
        $div.append("<input id='popup-answer' class='popup-text' type='text' name='answer' placeholder='Press \<Enter\> to submit.'>");
        $div.append($("<img>", {type:"button", id:"cancel-popup-new-list", class:"cancel-button"}));
        $("body").append($div);

        // implement functionality for close
        $('#cancel-popup-new-list').click(function(){
          $('.blur-overlay').remove();
          $('#new-list-popup').remove();
        });

        $('#popup-answer').keypress(function(event){
          if(event.which == 13){
            //Pressed Enter
            var val = $('#popup-answer').val();
            if(val.replace(' ','')){
              var list = document.getElementById("reading-lists");
              var item = document.createElement("li");
              var div = document.createElement("div");
              div.className = "list";
              div.setAttribute('id', val.replace(' ',''));
              var text = document.createTextNode(val);
              div.appendChild(text);
              item.appendChild(div);
              list.appendChild(item);
              var oldLabel = document.getElementsByClassName("current")[0]
              oldLabel.style.color = "grey";
              oldLabel.className = "";
              item.style.color = "#FFF";
              item.className = "current";    
            }
            $('#new-list-popup').remove();
            $('.blur-overlay').remove();

          }
        });
    });

      $('#table-button').hover(function(){
        if(mode != "row"){
          // mouseenter
          $(this).animate({'background-color':'#2CCCBC', "color": "#FFF"},300);
        }
      }, function(){
        if(mode != "row"){
          // mouseleave
          $(this).animate({'background-color':'#d4f4f1', "color": "#666"},300);
        }
      });

      $('#grid-button').hover(function(){
        if(mode != "grid"){
          // mouseenter
          $(this).animate({'background-color':'#2CCCBC', "color": "#FFF"},300);
        }
      }, function(){
        if(mode != "grid"){
          // mouseleave
          $(this).animate({'background-color':'#d4f4f1', "color": "#666"},300);
        }
      });       



    });
    </script>
  </head>
  
  <body>
    <div class="wrapper">
      <div id="big-frame">
        <div class="top-navigation">
          <div id="grid-button" class = "bar-button" type="button"/> 
          <img src="../graphics/grid.png" height="40px" style="opacity:0.7; position:relative; top:-3px"/> 
        </div>
        <div id="table-button" class = "bar-button" type="button"/> 
        <img src="../graphics/table.png" height="40px" style="opacity:0.7; position:relative; top:-3px">
      </div>
      <div id="logo-navigation-button" type="button">
        <span class="story">Story</span><span class="time">Time</span>
      </div>

    </div>        

    <div id="library-div" class="main-frame">
      <div id="column-left">
        <ul id = "column-left-contents" >
          <span id = "search"><label> Search </label> <input type = "text" name = "search"></span>
          <li class = "section" id = "library"><div class = "current" href = "#"> &nbsp My Library</a></li>
          <div id = "library-contents">
            <ul id = "reading-lists">
              <li><div class = "list" id = "dogs">Dogs</div></li>
              <li><div class = "list" id = "nature">Nature</div></li>
              <li><div class = "list" id = "robots">Robots</div></li>
              <li><div class = "list" id = "dragons">Dragons</div></li>
            </ul> 
          </div>
            <li class = "section"><div href = "#">&nbsp Discover More Books</a></li>
          
        </ul>
        <ul type="none">
          <li id = "new-list"><div href = "#">+ New Reading List</a></li>
        </ul>
      </div>
      <div id="column-center">
        <p>  </p>
      </div>
      <div id="column-right" class = "imgContain">
      </div>
    </div>

  </div>
  </div>

    

    <div class = "book-popup">
    <div id='pointer' style='position:absolute;'><img src = '../graphics/pointer.png'></div>

    <div id='mybook' style="height:600px; width:auto;">
      
      <div class="p-title" title='first-page'> 
        <center> 
          <h3 class = "book-text" style = "left: 120px">The Giving Tree</h3>
                    <br><br><br><br><br>

          <img style = "height:100%; width:auto;" src = '../graphics/book/GivingTree.jpg'> 
          <audio controls id="first-page" class="audio-controls">
            <source src="../audios/first-page.mp3" type="audio/mp3" style="visibility: none;">
            Your browser does not support the audio element.
          </audio>
        </center>
      </div>


      <div class="p-title" title='second-page'>
          <div class = "book-text" style = "width: 200px; left:30px; top:300px;">Once there was a tree</div>
          <img src = '../graphics/book/page1.png'>
          <audio controls id="second-page" class="audio-controls">
            <source src="../audios/second-page.mp3" type="audio/mp3">
            Your browser does not support the audio element.
          </audio>
      </div>
      <div  class="p-title" title='third-page'>
        <div class = "book-text" style = "width:150px; left:220px; top:180px;">And she loved a little boy</div>
        <img src = '../graphics/book/page2.png'>
      </div>

      <div  class="p-title" title='fourth-page'>
        <div class = "book-text" style = "left:200px; top:210px;">And every day the boy would come</div>
        <img src = '../graphics/book/page3.png'>
        <audio controls id="fourth-page" class="audio-controls">
          <source src="../audios/fourth-page.mp3" type="audio/mp3">
          Your browser does not support the audio element.
        </audio>  
      </div>
      <div  class="p-title" title='fifth-page'>
        <div class = "book-text" style = "width: 200px; left:80px; top:300px;">And he would gather her leaves</div>
        <img src = '../graphics/book/page4.png'>
      </div>

      <div  class="p-title" title='sixth-page'>
        <h3>The End.</h3>
        <audio controls id="sixth-page" class="audio-controls">
          <source src="../audios/sixth-page.mp3" type="audio/mp3">
          Your browser does not support the audio element.
        </audio>
      </div>
      <div  class="p-title" title='seventh-page'>
        <h3>
          <img src="../graphics/save.png" id="re-read">
          <img src="../graphics/trash.png" id="exit-book">
          <div id="re-read-label">Save</div>
          <div id="exit-book-label">Discard</div>
        </h3>
      </div>
    </div>

    <img id="cancel-popup" class="cancel-button"/>
    <br>
    <img id="recording" src="../graphics/not-record.png" name = "play">
  </div>

</body>
</html>
