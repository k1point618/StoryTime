<!DOCTYPE html>
<!--
   COLLABORATORS:
   keren gu
   katie bartel
   rodrigo lopez u
   
  -->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Kid's Library - StoryTime</title>
    <link rel="stylesheet" type="text/css" href="style/kid-library.css" />
    <link rel="stylesheet" type="text/css" href="style/main.css" />
    <link rel="stylesheet" type="text/css" media="all" href="jquery/css/smoothness/jquery-ui-1.10.4.custom.min.css">
    <link href="Booklet-master/booklet/jquery.booklet.latest.css" type="text/css" rel="stylesheet" media="screen, projection, tv" />


    <link href='http://fonts.googleapis.com/css?family=Englebert' rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script> window.jQuery || document.write('<script src="Booklet-master/booklet/jquery-2.1.0.min.js"><\/script>') </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script> window.jQuery.ui || document.write('<script src="Booklet-master/booklet/jquery-ui-1.10.4.min.js"><\/script>') </script>
    <script src="Booklet-master/booklet/jquery.easing.1.3.js"></script>
    <script src="Booklet-master/booklet/jquery.booklet.latest.js"></script>

    <script type="text/javascript">
      $(document).ready(function(){
        $("#mybook").booklet({
          pageNumbers: false,
          height: '100%',
          width: '80%',
          closed: true,
          autoCenter: true
        });
        // $("#mybook").css("width", "1000px");
        // $("#mybook").css("height", "600px");
        // $(".b-page").css("width", "500px");
        // $(".b-page").css("height", "600px");
        // $(".b-wrap").css("width", "100%");
        // $(".b-wrap").css("height", "100%");

        //$("#mybook").hide();
        $(".book-popup").hide();
        var top = 3;
        var selectToggle = -1;
        var library = document.getElementById("library-div");
        var libraryWidth = library.offsetWidth - 200;
        var libraryHeight = library.offsetHeight - 300;
        var widthBlock= 20;
        var heightBlock = 12;
        var widthPool = range(widthBlock);
        var heightPool = range(heightBlock);
        var bookString = "";

        console.log(libraryWidth);
        console.log(libraryHeight);
        populateBooks(true);


        // Event listeners -----------------
        $('#order-button').click(function(){
          clearBooks();
          populateBooks(false);
        });

        $('#order-button').hover(function(){
          // mouseenter
          $(this).animate({'background-color':'#2CCCBC', "color": "#FFF"},300);

        }, function(){
          // mouseleave
          $(this).animate({'background-color':'#d4f4f1', "color": "#666"},300);

        });

        $('#random-button').click(function(){
          clearBooks();
          populateBooks(true);
        });

        $('#random-button').hover(function(){
          // mouseenter
          $(this).animate({'background-color':'#2CCCBC', "color": "#FFF"},300);

        }, function(){
          // mouseleave
          $(this).animate({'background-color':'#d4f4f1', "color": "#666"},300);

        });

        $('#logo-navigation-button').click(function(){
          console.log("go to home")
          window.location.href = 'home.html';
        });

        


        // Helper functions ----------------------------------
        function populateBooks(random){
          var library = document.getElementById("library-div");
          for(var i = 1; i <= 12; i ++){
            var filename = "../graphics/" + i + ".jpeg";
            var image = document.createElement("IMG");
            image.src = filename;
            image.id = i + "";
            image.className = "draggable book-image unselected";
            image.style.padding = "5px";
            image.style.height = "190px";
            image.style.width = "90px";
            
            if(random){
              image.style.position = "absolute";
              image.style.left = Math.floor(getNumber(widthPool) * (libraryWidth / widthBlock)) + "px";
              image.style.top = Math.floor(getNumber(heightPool) * (libraryHeight / heightBlock))+ "px";
              console.log(image.style.left);
              console.log(image.style.top);
            }
            library.appendChild(image); 

            if(i == 12){
              $(image).removeClass('unselected');
              $(image).addClass('selected');
              $(image).addClass('openable');
            }

            $(image).each(function(){
                $(this).width($(this).width() * 1.5);
                $(this).draggable({
                  scroll:false,
                  containment:$(this).parent()
                });
            });
            
            $(image).mouseup(function(){
              if($(this).hasClass('openable')){
                openBook($(this));
              }
              if($(this).hasClass('selected')){
                $(this).addClass('openable');
                $(this).siblings().removeClass('openable');
              }
              $(this).addClass('top').removeClass('bottom');
              $(this).siblings().removeClass('top').addClass('bottom');              
            });

            $(image).mousedown(function(){
              
              $(this).css("z-index", top++);
              $(this).removeClass('unselected');
              $(this).addClass('selected');
              $(this).siblings().removeClass('selected').addClass('unselected');
              
            });

          }

        }


        function clearBooks(){
          var library = document.getElementById("library-div");
          while (library.firstChild) {
              library.removeChild(library.firstChild);
          }
          widthPool = range(widthBlock);
          heightPool = range(heightBlock);
        }

        function openBook(book){
          $("body").append("<div class='blur-overlay'></div>");

          var id = book[0].id;
          $(".book-popup").show();

        /*  var cover = document.createElement("IMG");
          cover.src = "../graphics/GivingTree.jpg";
          cover.id = "book-cover";

          // var reader1 = document.createElement("IMG");
          // reader1.src = "../graphics/user.png";
          // reader1.className = "reader";
          // reader1.id = "reader1"

          // var reader2 = document.createElement("IMG");
          // reader2.src = "../graphics/user.png";
          // reader2.className = "reader";
          // reader2.id = "reader2"

          

          $div.append(cover);
          // $div.append(reader1);
          // $div.append(reader2);*/
          
          $('#cancel-popup').click(function(){
            $('.blur-overlay').remove();
            //$('.book-popup').remove();
            //$("#mybook").hide();
            $(".book-popup").hide();

          // animate text
          $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);
           $('#boldText').animate({"font-weight": "900"},500);
          $('#boldText').animate({"font-weight": "normal"},500);

          });

 
          
          $("#play-button").click(function(){
            var divElement = $('.b-p1').find('.p-title')[0];
            var title = divElement.title;
            console.log(title);
            var audio = document.getElementById(title);
            audio.play();
          });

          $(".book-popup").append(playButton);

          
        }

        function getNumber(pool) {
            if (pool.length == 0) {
                throw "No numbers left";
            }
            var index = Math.floor(pool.length * Math.random());
            var drawn = pool.splice(index, 1);
            return drawn[0];
        };

        function range(i){return i?range(i-1).concat(i):[]};

      });
      
    </script>

  </head>
  

  <body>
    
    <div id="big-frame">
      <div class="top-navigation">

        <div id="order-button" class="bar-button" type="button"/> 
          Organize 
        </div>

        <div id="random-button" class="bar-button" type="button"/> 
          Randomize 
        </div>

        <div id="logo-navigation-button" type="button">
          <span class="story">Story</span><span class="time">Time</span>
        </div>
        
      </div>

      <div id="library-div" class="main-frame">
      </div>


    </div>

  <div id="preload">
     <img src="../graphics/1.jpeg" width="1" height="1" alt="Image 01" />
     <img src="../graphics/2.jpeg" width="1" height="1" alt="Image 02" />
     <img src="../graphics/3.jpeg" width="1" height="1" alt="Image 03" />
     <img src="../graphics/4.jpeg" width="1" height="1" alt="Image 04" />
     <img src="../graphics/5.jpeg" width="1" height="1" alt="Image 05" />
     <img src="../graphics/6.jpeg" width="1" height="1" alt="Image 06" />
     <img src="../graphics/7.jpeg" width="1" height="1" alt="Image 07" />
     <img src="../graphics/8.jpeg" width="1" height="1" alt="Image 08" />
     <img src="../graphics/9.jpeg" width="1" height="1" alt="Image 09" />
     <img src="../graphics/10.jpeg" width="1" height="1" alt="Image 10" />
     <img src="../graphics/11.jpeg" width="1" height="1" alt="Image 11" />
     <img src="../graphics/12.jpeg" width="1" height="1" alt="Image 12" />
     <img src="../graphics/GivingTree.jpg" width="1" height="1" alt="Image 13" />
      <img src="../graphics/play.png" width="1" height="1" alt="Image 14" />
  </div>
 
  <div class = "book-popup">
    <div id='mybook' style="height:600px; width:auto;">
      <div  class="p-title" title='first-page'> 
        <center> 
          <h3>The Giving Tree</h3>
          <img src = '../graphics/book/GivingTree.jpg'> 
          <audio controls id="first-page" class="audio-controls">
            <source src="../audios/first-page.mp3" type="audio/mp3">
            Your browser does not support the audio element.
          </audio>
        </center>
      </div>
      <div class="p-title" title='second-page'>
          <h3>Once there was a tree</h3>
          <!-- <img src = '../graphics/book/Maple-tree.png'> -->
      </div>
      <div  class="p-title" title='third-page'>
        <h3>That loved a little boy</h3>
        <img src = '../graphics/book/boy.png'>
        <audio controls id="third-page" class="audio-controls">
          <source src="../audios/third-page.mp3" type="audio/mp3">
          Your browser does not support the audio element.
        </audio>  
      </div>
      <div  class="p-title" title='fourth-page'>
        <h3>And every day the boy would come</h3>
        <!-- <embed class="audio" id="fourth-page" src="../audio/fourth-page.mp3"> -->
          
      </div>
      <div  class="p-title" title='fifth-page'>
        <h3>All over the tree!</h3>
        <audio controls id="first-page" class="audio-controls">
          <source src="../audios/first-page.mp3" type="audio/mp3">
          Your browser does not support the audio element.
        </audio>
      </div>
      <div  class="p-title" title='sixth-page'>
        <h3>The End.</h3>
        <h2><a href = 'kid-library.html'>here</a></h2>
      </div>
    </div>

    <img id="cancel-popup" class="cancel-button"/>

    <img id="play-button" src="../graphics/play2.png">
  </div>

  </body>
</html>
